Import('use')

testEnv = use.Clone()
testEnv.VariantDir('test', '../../', duplicate = False)
testEnv.VariantDir('common', '../common/', duplicate = False)

use = testEnv

# use.Append(LIBS = ['mugen'])
# SConscript('../../mugen/SConscript', exports = ['use'], variant_dir = 'mugen')

most_game_source = Split("""
test/globals.cpp
test/configuration.cpp
test/factory/font_render.cpp
test/factory/font_factory.cpp
""")

load_source = Split("""
load.cpp
common/init.cpp
""")

stage_source = Split("""
load-stage.cpp
common/init.cpp
test/globals.cpp
test/configuration.cpp
test/factory/font_render.cpp
test/factory/font_factory.cpp
""")

select_source = most_game_source + Split("""
load-select.cpp
common/init.cpp
""")

ignore = """
"""

full_source = most_game_source + Split("""
load-full.cpp
common/init.cpp
""")

sffv2_source = Split("""
sffv2.cpp
sff.cpp
test/globals.cpp
test/factory/font_factory.cpp
test/configuration.cpp
""")

parse_source = Split("""
parse.cpp
test/mugen/ast/ast.cpp
test/mugen/exception.cpp
""")

match_source = Split("""
run-match.cpp
test/factory/font_factory.cpp
test/configuration.cpp
test/globals.cpp
test/factory/font_render.cpp
""")

states_source = Split("""
states.cpp
test/factory/font_factory.cpp
test/configuration.cpp
test/globals.cpp
test/factory/font_render.cpp
""")


character_select_source = Split("""
common/init.cpp
common/timer.cpp
select-main.cpp
test/mugen/character-select.cpp
""")

view_source = Split("""
view.cpp
test/globals.cpp
test/configuration.cpp
test/factory/font_factory.cpp
test/factory/font_render.cpp
""")

versus_source = Split("""
common/init.cpp
common/timer.cpp
versus.cpp
""")

widgets_source = Split("""
common/init.cpp
common/timer.cpp
widgets.cpp
test/mugen/option-options.cpp
test/mugen/widgets.cpp
test/util/exceptions/exception.cpp
""")

x = []
def makeTest(name, files):
    test = testEnv.Program(name, files)
    x.extend(test)
    testEnv.AddPostAction(test, testEnv['PAINTOWN_TEST'])

# x.append(testEnv.Program('load', load_source + most_game_source))
makeTest('load-full', full_source)
makeTest('load-select', select_source)
makeTest('load', load_source + most_game_source)
makeTest('serialize', ['serialize.cpp'])
makeTest('load-stage', stage_source)
makeTest('sffv2', sffv2_source)
makeTest('load-sff', ['load-sff.cpp', 'common/init.cpp'] + most_game_source)
x.extend(testEnv.Program('run-match', match_source))
x.extend(testEnv.Program('states', states_source))
x.extend(testEnv.Program('parse', parse_source))
# x.append(testEnv.Program('load-stage', stage_source))
x.extend(testEnv.Program('palette', ['palette.cpp']))
x.extend(testEnv.Program('view', view_source))

# Character Select test
character_select = testEnv.Program('character-select', character_select_source + most_game_source)
x.extend(character_select)

# Versus Test
versus = testEnv.Program('versus', versus_source + most_game_source)
x.extend(versus)

# Widget Test
widgets = testEnv.Program('widgets', widgets_source + most_game_source)
x.extend(widgets)

Return('x')
