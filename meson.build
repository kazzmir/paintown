# Warning: changing the default_options requires a new build directory and doing 'meson setup ...' again
project('paintown', ['c', 'cpp'], default_options: ['cpp_std=c++11'])

add_global_arguments('-DUSE_SDL2=1', language: 'cpp')
add_global_arguments('-DDATA_PATH="data"', language: 'cpp')
add_global_arguments('-g3', language: ['cpp', 'c'])
add_global_arguments(['-Wno-unused-variable', '-Wno-unused-function', '-Wno-unused-parameter', '-Wextra'], language: ['cpp', 'c'])
add_global_arguments(['-fsanitize=address'], language: ['cpp', 'c'])

includes = include_directories('src')
dumb_includes = include_directories('src/r-tech1/libs/dumb/include')
all_code = [
  'src/xmain.cpp',
  'src/main-menu.cpp',
  'src/factory/collector.cpp',
  'src/factory/font_render.cpp',
  'src/globals.cpp',
]

sdl_dependency = dependency('sdl2', required: true)
sdl_image_dependency = dependency('SDL2_image', required: true)
sdl_ttf_dependency = dependency('SDL2_ttf', required: true, version: '>=2.0.18')
sdl_mixer_dependency = dependency('SDL2_mixer', required: true)
# freetype_dependency = dependency('freetype2', required: true)
zlib_dependency = dependency('zlib', required: true)

subdir('src/r-tech1')
subdir('src/mugen')
subdir('src/paintown-engine')
subdir('src/openbor')

test_dependencies = [sdl_dependency, sdl_image_dependency, sdl_ttf_dependency, sdl_mixer_dependency, zlib_dependency]
test_linkages = [rtech1_library, mugen_library, paintown_library, openbor_library]
test_link_args = ['-fsanitize=address']

executable('paintown', all_code,
  include_directories: [includes, dumb_includes],
  dependencies: [sdl_dependency, sdl_image_dependency, sdl_ttf_dependency, sdl_mixer_dependency, zlib_dependency],
  link_with: [rtech1_library, mugen_library, paintown_library, openbor_library],
  link_args: ['-fsanitize=address'],
  )

subdir('src/test/paintown')
subdir('src/test/graphics')
subdir('src/test/audio')